import paramiko
import time

# 创建 SSH 客户端
client = paramiko.SSHClient()

# 自动添加主机密钥（避免第一次连接时询问是否信任）
client.set_missing_host_key_policy(paramiko.AutoAddPolicy())

# 连接到远程主机
hostname = 'example.com'  # 远程服务器的 IP 或域名
port = 22                 # 默认 SSH 端口是 22
username = 'your_username'  # 你的 SSH 用户名
password = 'your_password'  # 你的 SSH 密码

try:
    # 连接到远程服务器
    client.connect(hostname, port, username, password)

    # 创建一个交互式 shell
    channel = client.invoke_shell()

    # 设置为非阻塞模式
    channel.setblocking(0)

    # 等待 shell 启动完成
    time.sleep(1)

    # 发送 'journalctl -f' 命令来实时查看日志
    channel.send("sudo journalctl -f\n")
    time.sleep(1)  # 等待命令启动

    # 需要输入 sudo 密码
    while True:
        if channel.recv_ready():
            output = channel.recv(1024).decode('utf-8')
            print(output, end="")  # 打印实时输出

            # 如果输出包含 'password' 字样，表示需要输入密码
            if 'password' in output.lower():
                print("Detected sudo password prompt.")
                channel.send('your_sudo_password\n')  # 发送 sudo 密码
                time.sleep(1)  # 等待密码被接受

        # 防止 CPU 占用过高
        time.sleep(0.1)

except Exception as e:
    print(f"Connection failed: {e}")
finally:
    # 关闭连接
    client.close()
